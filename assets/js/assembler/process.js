var keyStrokes=[],processingKeyStrokes=!1,userBadBytes=[];function shouldProcess(e){return e>47&&e<58||32==e||13==e||8==e||e>64&&e<91||e>95&&e<112||e>185&&e<193||e>218&&e<223}function combineSpans(e,t){var n=t[0];if(""==n.textContent&&n!=e){var o=n.previousSibling,r=n.nextSibling;o&&r&&","!=o.textContent&&","!=r.textContent&&(o.textContent+=r.textContent,n.parentNode.removeChild(r),n.parentNode.removeChild(n))}}function processKeyDown(e){if(shouldProcess(e.keyCode)&&!e.ctrlKey&&!e.altKey&&(e.preventDefault(),keyStrokes.push(e),!processingKeyStrokes)){for(processingKeyStrokes=!0;keyStrokes.length;)try{var t=keyStrokes.shift();switch(t.key){case"Backspace":document.execCommand("delete",!1,null);break;case"Enter":fixSpan(findPosition()," ",!0),document.execCommand("insertParagraph",!1,null);break;default:document.execCommand("insertText",!1,t.key)}processKeyPressed(e)}catch(e){console.log(e)}processingKeyStrokes=!1}}function processKeyPressed(e){var t=findPosition(),n=document.getElementById("assembly");switch(e.keyCode){case 32:fixSpan(t," ",!1);break;case 57:case 48:if(!e.shiftKey)break;case 188:fixSpan(t,e.key,!1);break;case 13:t[0].className="",addLineNumber(n,!1);break;case 8:combineSpans(n,t);case 46:removeLineNumber(n)}syntaxHighlight(n),updateBytes()}function findPosition(){var e=window.getSelection(),t=e.anchorNode.parentNode;return"DIV"==t.tagName&&(t=e.anchorNode),[t,e.focusOffset]}function fixSpan(e,t,n){var o=e[0].textContent.split(t);if(1!=o.length){if(!(o.length>2))if(""!=o[0]||""!=o[1]){if(""==o[0]&&e[0].previousSibling&&e[0].previousSibling.textContent.endsWith(t))return e[0].previousSibling.textContent+=t,void(e[0].textContent=e[0].textContent.slice(1));if(""==o[1]&&e[0].nextSibling&&e[0].nextSibling.textContent.startsWith(t))return e[0].nextSibling.textContent=t+e[0].nextSibling.textContent,void(e[0].textContent=e[0].textContent.slice(0,e[0].textContent.length-1));var r=document.createElement("span"),a=document.createElement("span"),i=null,s=null,d=0;""==o[0]||" "==o[0]?(r.innerHTML=t,a.textContent=e[0].textContent.replace(t,""),s=a,n&&(d=1)):""==o[1]||" "==o[1]?(r.textContent=e[0].textContent.replace(t,""),a.innerHTML=t):(r.textContent=o[0],a.textContent=o[1],(i=document.createElement("span")).innerHTML="&nbsp",s=a),e[0].parentNode.insertBefore(r,e[0]),i&&e[0].parentNode.insertBefore(i,e[0]),e[0].parentNode.insertBefore(a,e[0]),e[0].parentNode.removeChild(e[0]),s&&setCursor(s,d)}else setCursor(e[0],e[1])}else if(3==e[0].nodeType){var l=document.createElement("span");l.textContent=o[0],e[0].replaceWith(l),setCursor(l,1)}}function setCursor(e,t){var n=document.createRange(),o=document.getSelection();n.setStart(e,t),n.collapse(!0),o.removeAllRanges(),o.addRange(n)}function addLineNumber(e,t){var n=document.getElementById("line-numbers");for(null!=e.children&&0!=e.children.length||(t=!0);n.children.length<e.children.length||t;){var o=document.createElement("span");o.className="line-number",n.appendChild(o),t=!1}}function removeLineNumber(e){for(var t=document.getElementById("line-numbers");e.children.length<t.children.length;){if(1==t.children.length)return;t.removeChild(t.childNodes[t.childElementCount-1])}}function processDelete(e){"deleteContentBackward"!==e.inputType&&"deleteContentForward"!==e.inputType||updateBytes()}function updateBytes(){var e=document.getElementById("assembly"),t=document.getElementById("bytes"),n=document.getElementById("endian").value,o=document.getElementById("byte-string"),r=document.getElementById("errors"),a=document.getElementById("error-count");o.textContent="No bytes found. Write some assembly first.",clearSpan(t),clearSpan(r),r.textContent="No errors detected.",a.className="",e.childNodes.forEach(e=>{convert_instruction(e,t,n)})}function copyBytesToClipboard(){var e=document.getElementById("byte-string");if(e.textContent.startsWith("No bytes"))tooltip.textContent="No bytes to copy. Write some assembly first.";else{document.getElementById("tooltip");navigator.clipboard.writeText(e.textContent).then(function(){tooltip.textContent="Copied "+e.textContent.length/4+" bytes."},function(e){})}}function clearTooltip(e){document.getElementById("tooltip");tooltip.textContent="Copy bytes to clipboard"}function convert_instruction(e,t,n){var o=[" "];if(""!=e.textContent){o=[];try{var r=getParser();if(void 0===r)return;for(var a=new r(e).bytes,i=0;i<a.length;i++)o="little"===n?o.concat(a[i].reverse()):o.concat(a[i]),e.className="";addToByteString(o)}catch(t){document.getElementById("error-count").className="errors-present",addErrorMessage(e,t.message),e.className="invalid-instruction"}}else e.className="";(a=document.createElement("div")).className="byte-line",(s=document.createElement("span")).textContent=" ",a.appendChild(s);for(i=0;i<o.length;i++){var s,d=document.createElement("span");d.textContent=o[i],-1!=userBadBytes.indexOf(o[i])&&(d.className="bad-byte"),a.appendChild(d),(s=document.createElement("span")).textContent=" ",a.appendChild(s)}t.appendChild(a)}function addErrorMessage(e,t){var n=document.createElement("div"),o=Array.prototype.indexOf.call(e.parentElement.children,e)+1,r=document.getElementById("errors"),a=document.getElementById("error-count");0==r.childElementCount&&(r.textContent=""),n.textContent="Line "+o+": "+t,r.appendChild(n),a.textContent=r.childElementCount}function addToByteString(e){var t=document.getElementById("byte-string");if(0!=e.length){t.textContent.startsWith("No bytes")&&(t.textContent="");for(var n=0;n<e.length;n++)t.textContent+="\\x"+e[n].toString(16)}}function loadArchitecture(e){var t=e.target.value,n=document.getElementById("assembly");if(""==t)return n.textContent="Select architecture above to get started.",void(n.contentEditable=!1);mipsInstructions=new MipsInstructions(t),n.innerHTML=loadMessage(),fixupPlainText(n),syntaxHighlight(n),n.contentEditable=!0}function clearSpan(e){if(null!=e)for(;e.firstChild;)e.removeChild(e.firstChild)}function hoverUpdateBadBytes(e){0!=e.buttons&&updateBadBytes(e)}function updateBadBytes(e){-1==e.target.className.split(" ").indexOf("down")?e.target.className+=" down":e.target.className=" ";var t=e.target.value.slice(2),n=userBadBytes.indexOf(t);-1!=n?userBadBytes.splice(n,1):userBadBytes.push(t),updateBytes()}function handleCollapse(e){var t=e.target;if(t.id.endsWith("collapse"))t.classList.toggle("active");else{if("copy-bytes"==e.target.id)return void copyBytesToClipboard();(t=t.parentElement).classList.toggle("active")}var n=t.nextElementSibling;n.style.maxHeight?(n.style.maxHeight=null,n.style.overflow="hidden"):(n.style.maxHeight=n.scrollHeight+"px",n.style.overflow="initial")}function fixupPlainText(e){var t=e.innerText.split("\n");e.innerText="",t.forEach(t=>{var n=document.createElement("div");if(""!=t&&" "!=t)t.split(" ").forEach(e=>{var t=document.createElement("span"),o=document.createElement("span"),r=null;e.endsWith(",")&&(e=e.slice(0,e.length-1),(r=document.createElement("span")).textContent=","),t.textContent=e,o.textContent=" ",n.appendChild(t),r&&n.appendChild(r),n.appendChild(o)});else{var o=document.createElement("br");n.appendChild(o)}e.appendChild(n),addLineNumber(e,!1)}),updateBytes()}function onReady(e){"complete"===document.readState||"interactive"===document.readyState?setTimeout(e,1):document.addEventListener("DOMContentLoaded",e)}onReady(function(){var e=document.getElementById("assembly"),t=(document.getElementById("errors"),document.getElementById("error-count"),document.getElementById("endian")),n=document.getElementById("arch"),o=document.getElementById("bad-bytes"),r=document.getElementById("bb-collapse"),a=document.getElementById("bs-collapse"),i=document.getElementById("err-collapse");e.value="",n.value="",addLineNumber(e,!0),e.addEventListener("keydown",processKeyDown),e.addEventListener("input",processDelete),t.addEventListener("change",updateBytes),n.addEventListener("change",loadArchitecture),r.addEventListener("click",handleCollapse),a.addEventListener("click",handleCollapse),i.addEventListener("click",handleCollapse);for(var s=0;s<=255;s++){var d=document.createElement("input");d.type="button";var l=s.toString(16);l.length<2&&(l="0"+l),d.value="0x"+l,d.addEventListener("mousedown",updateBadBytes),d.addEventListener("mouseenter",hoverUpdateBadBytes),o.appendChild(d)}});